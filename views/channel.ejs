<h1><%= channel.name %></h1>

<div id="messages">
    <% for (post of channel.posts) { %>
        <div data-id="<%= post._id %>" id="<%= post._id %>" class="post">
            <div>
                <p> <%= post.author %> <span> <%= post.published %> </span></p>
                <h4> <%= post.content %> </h4>
            </div>
            <button class="btn btn-primary reply_btn">Reply</button>
            <% for (reply of post.replies) { %>
                <div class="post_reply">
                    <p> <%= reply.author %> <span> <%= reply.time %> </span></p>
                    <p> <%= reply.content %> </p>
                </div>
            <% } %> 
        </div>
    <% } %> 
</div>

<div>
    <form id="chat_form">
        <input 
            type="text"
            name="message"
            id="msg"
            placeholder="Enter message"
            autocomplete="off"
            required
            >
        <input type="hidden" id="user" value="<%= user %>">
        <input type="hidden" id="channel" value="<%= channel._id %>">

        <button class="btn btn-primary">Send</button>
    </form>
</div>
<button 
    id="invite_btn" 
    class="btn btn-primary"
    data-bs-toggle="modal" 
    data-bs-target="#invite_modal">
    Invite teammates to join <%= channel.name %> 
</button>

<div class="modal" id="invite_modal" tabindex="-1">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Invite teammates to join <%= channel.name %></h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
            <form action="/channels/add" method="post">
                <ul>

                </ul>
                <% for (user of non_subscribers) {%> 
                    <li>
                        <input 
                        name="non_subscriber" 
                        type="checkbox" 
                        value="<%= user._id %>" 
                        id="<%= user._id %>"
                        >
                        <label for="<%= user._id %>">
                            <%= user.first_name %> <%= user.last_name %>
                        </label>
                    </li>
                <% } %>
            </form>
                
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary" onclick="inviteUsersToChannel()">Invite</button>
            </div>
        </div>
    </div>
  </div>


<script
src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta2/dist/js/bootstrap.bundle.min.js"
integrity="sha384-b5kHyXgcpbZJO/tY9Ul7kGkf1S0CWuKcCD38l8YkeH8z8QjE0GmW1gYU5S9FOnJ0"
crossorigin="anonymous"
></script>
<script src="/socket.io/socket.io.js"></script>
<script src="/public/scripts/chat.js"></script>